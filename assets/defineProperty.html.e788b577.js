import{_ as e}from"./8.6c747d4d.js";import{_ as o,o as c,c as l,b as n,d as s,e as i,t as a,a as t,r as u}from"./app.c4ba29fa.js";const k={},r=n("h1",{id:"\u53CC\u5411\u6570\u636E\u7ED1\u5B9A\u539F\u7406",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u53CC\u5411\u6570\u636E\u7ED1\u5B9A\u539F\u7406","aria-hidden":"true"},"#"),s(" \u53CC\u5411\u6570\u636E\u7ED1\u5B9A\u539F\u7406")],-1),d=n("code",null,"\u6570\u636E\u52AB\u6301",-1),v=n("code",null,"\u53D1\u5E03\u8005-\u8BA2\u9605\u8005\u6A21\u5F0F",-1),m=n("code",null,"Object.defineProperty()",-1),b=n("code",null,"setter",-1),h=n("code",null,"getter",-1),g={href:"https://so.csdn.net/so/search?q=%E7%9B%91%E5%90%AC&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},w=t('<p><img src="'+e+`" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0"></p><h2 id="\u81EA\u5B9A\u4E49-vue-\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49-vue-\u7C7B" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49 vue \u7C7B</h2><ul><li>vue \u6700\u5C11\u9700\u8981\u4E24\u4E2A\u53C2\u6570\uFF1A\u6A21\u677F\u548C data</li><li>\u521B\u5EFA Compiler \u5BF9\u8C61\uFF0C\u5C06\u6570\u636E\u6E32\u67D3\u5230\u6A21\u677F\u540E\uFF0C\u6302\u8F7D\u5230\u6307\u5B9A\u8DDF\u8282\u70B9\u4E2D</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyVue</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1\uFF0C\u63A5\u6536\u4E24\u4E2A\u53C2\u6570\uFF1A\u6A21\u677F\uFF08\u6839\u8282\u70B9\uFF09\uFF0C\u548C\u6570\u636E\u5BF9\u8C61</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4FDD\u5B58\u6A21\u677F\uFF0C\u548C\u6570\u636E\u5BF9\u8C61</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isElement</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$el <span class="token operator">=</span> options<span class="token punctuation">.</span>el
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$data <span class="token operator">=</span> options<span class="token punctuation">.</span>data
    <span class="token comment">// 2.\u6839\u636E\u6A21\u677F\u548C\u6570\u636E\u5BF9\u8C61\uFF0C\u6E32\u67D3\u5230\u6839\u8282\u70B9</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u76D1\u542Cdata\u6240\u6709\u5C5E\u6027\u7684get/set</span>
      <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">)</span>
      <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u5224\u65AD\u662F\u5426\u662F\u4E00\u4E2Adom\u5143\u7D20</span>
  <span class="token function">isElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5B9E\u73B0\u6570\u636E\u9996\u6B21\u6E32\u67D3\u5230\u9875\u9762" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u6570\u636E\u9996\u6B21\u6E32\u67D3\u5230\u9875\u9762" aria-hidden="true">#</a> \u5B9E\u73B0\u6570\u636E\u9996\u6B21\u6E32\u67D3\u5230\u9875\u9762</h2><p><strong>Compiler</strong></p><ol><li>node2fragment \u51FD\u6570\u5C06\u6A21\u677F\u5143\u7D20\u63D0\u53D6\u5230\u5185\u5B58\u4E2D\uFF0C\u65B9\u4FBF\u5C06\u6570\u636E\u6E32\u67D3\u5230\u6A21\u677F\u540E\uFF0C\u518D\u4E00\u6B21\u6027\u6302\u8F7D\u5230\u9875\u9762\u4E2D</li><li>\u6A21\u677F\u63D0\u53D6\u5230\u5185\u5B58\u540E\uFF0C\u4F7F\u7528 buildTemplate \u51FD\u6570\u904D\u5386\u8BE5\u6A21\u677F\u5143\u7D20</li></ol>`,7),f=n("li",null,[s("\u5143\u7D20\u8282\u70B9 "),n("ul",null,[n("li",null,"\u4F7F\u7528 buildElement \u51FD\u6570\u68C0\u67E5\u5143\u7D20\u4E0A\u4EE5 v- \u5F00\u5934\u7684\u5C5E\u6027")])],-1),y={start:"3"},x=n("li",null,"\u5230\u6B64\u5C31\u5B8C\u6210\u4E86\u9996\u6B21\u6570\u636E\u6E32\u67D3\uFF0C\u63A5\u4E0B\u6765\u9700\u8981\u5B9E\u73B0\u6570\u636E\u6539\u53D8\u65F6\uFF0C\u81EA\u52A8\u66F4\u65B0\u89C6\u56FE",-1),_=t(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token comment">// 1.\u5C06\u7F51\u9875\u4E0A\u7684\u5143\u7D20\u653E\u5230\u5185\u5B58\u4E2D</span>
    <span class="token keyword">let</span> fragment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">node2fragment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span>
    <span class="token comment">// 2.\u5229\u7528\u6307\u5B9A\u7684\u6570\u636E\u7F16\u8BD1\u5185\u5B58\u4E2D\u7684\u5143\u7D20</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildTemplate</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>
    <span class="token comment">// 3.\u5C06\u7F16\u8BD1\u597D\u7684\u5185\u5BB9\u91CD\u65B0\u6E32\u67D3\u5230\u7F51\u9875\u4E0A</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">node2fragment</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.\u521B\u5EFA\u4E00\u4E2A\u7A7A\u7684\u6587\u6863\u788E\u7247\u5BF9\u8C61</span>
    <span class="token keyword">let</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 2.\u7F16\u8BD1\u5FAA\u73AF\u53D6\u5230\u6BCF\u4E00\u4E2A\u5143\u7D20</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> app<span class="token punctuation">.</span>firstChild
    <span class="token keyword">while</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u6CE8\u610F\u70B9: \u53EA\u8981\u5C06\u5143\u7D20\u6DFB\u52A0\u5230\u4E86\u6587\u6863\u788E\u7247\u5BF9\u8C61\u4E2D, \u90A3\u4E48\u8FD9\u4E2A\u5143\u7D20\u5C31\u4F1A\u81EA\u52A8\u4ECE\u7F51\u9875\u4E0A\u6D88\u5931</span>
      fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
      node <span class="token operator">=</span> app<span class="token punctuation">.</span>firstChild
    <span class="token punctuation">}</span>
    <span class="token comment">// 3.\u8FD4\u56DE\u5B58\u50A8\u4E86\u6240\u6709\u5143\u7D20\u7684\u6587\u6863\u788E\u7247\u5BF9\u8C61</span>
    <span class="token keyword">return</span> fragment
  <span class="token punctuation">}</span>

  <span class="token function">buildTemplate</span><span class="token punctuation">(</span><span class="token parameter">fragment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> nodeList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>fragment<span class="token punctuation">.</span>childNodes<span class="token punctuation">]</span>
    nodeList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u9700\u8981\u5224\u65AD\u5F53\u524D\u904D\u5386\u5230\u7684\u8282\u70B9\u662F\u4E00\u4E2A\u5143\u7D20\u8FD8\u662F\u4E00\u4E2A\u6587\u672C</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">isElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5143\u7D20\u8282\u70B9</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
        <span class="token comment">// \u5904\u7406\u5B50\u5143\u7D20</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildTemplate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6587\u672C\u8282\u70B9</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildText</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">buildElement</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> attrs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>node<span class="token punctuation">.</span>attributes<span class="token punctuation">]</span>
    attrs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">attr</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// v-model=&quot;name&quot; =&gt; {name:v-model  value:name}</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> attr
      <span class="token comment">// v-model / v-html / v-text / v-xxx</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;v-&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// v-model -&gt; [v, model]</span>
        <span class="token keyword">let</span> <span class="token punctuation">[</span>_<span class="token punctuation">,</span> directive<span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;-&#39;</span><span class="token punctuation">)</span>
        CompilerUtil<span class="token punctuation">[</span>directive<span class="token punctuation">]</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">buildText</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> node<span class="token punctuation">.</span>textContent
    <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\{\\{.+?\\}\\}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      CompilerUtil<span class="token punctuation">[</span><span class="token string">&#39;content&#39;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> CompilerUtil <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u89E3\u6790this.data.aaa.bbb.ccc\u8FD9\u79CD\u5C5E\u6027</span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> currentKey</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> data<span class="token punctuation">[</span>currentKey<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> vm<span class="token punctuation">.</span>$data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u89E3\u6790{{}}\u4E2D\u7684\u53D8\u91CF</span>
    <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\{\\{(.+?)\\}\\}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// \u89E3\u6790v-model\u6307\u4EE4</span>
  <span class="token function-variable function">model</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5728\u89E6\u53D1getter\u4E4B\u524D\uFF0C\u4E3Adom\u521B\u5EFAWather\uFF0C\u5E76\u4E3AWatcher.target\u8D4B\u503C</span>
    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    node<span class="token punctuation">.</span>value <span class="token operator">=</span> val
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// \u89E3\u6790v-html\u6307\u4EE4</span>
  <span class="token function-variable function">html</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5728\u89E6\u53D1getter\u4E4B\u524D\uFF0C\u4E3Adom\u521B\u5EFAWather\uFF0C\u5E76\u4E3AWatcher.target\u8D4B\u503C</span>
    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> newValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    node<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> val
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// \u89E3\u6790v-text\u6307\u4EE4</span>
  <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5728\u89E6\u53D1getter\u4E4B\u524D\uFF0C\u4E3Adom\u521B\u5EFAWather\uFF0C\u5E76\u4E3AWatcher.target\u8D4B\u503C</span>
    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>innerText <span class="token operator">=</span> newValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    node<span class="token punctuation">.</span>innerText <span class="token operator">=</span> val
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// \u89E3\u6790{{}}\u4E2D\u7684\u53D8\u91CF</span>
  <span class="token function-variable function">content</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\{\\{(.+?)\\}\\}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u5728\u89E6\u53D1getter\u4E4B\u524D\uFF0C\u4E3Adom\u521B\u5EFAWather\uFF0C\u5E76\u4E3AWatcher.target\u8D4B\u503C</span>
      <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newValue
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> val
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5B9E\u73B0\u6570\u636E\u9A71\u52A8\u89C6\u56FE" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u6570\u636E\u9A71\u52A8\u89C6\u56FE" aria-hidden="true">#</a> \u5B9E\u73B0\u6570\u636E\u9A71\u52A8\u89C6\u56FE</h2><p><strong>Observer</strong></p><ol><li>\u4F7F\u7528 defineRecative \u51FD\u6570\u5BF9 data \u505A Object.defineProperty \u5904\u7406\uFF0C\u4F7F\u5F97 data \u4E2D\u7684\u6BCF\u4E2A\u6570\u636E\u90FD\u53EF\u4EE5\u8FDB\u884C get/set \u76D1\u542C</li><li>\u63A5\u4E0B\u6765\u5C06\u8003\u8651\u5982\u4F55\u5728\u76D1\u542C\u5230 data \u503C\u6539\u53D8\u540E\uFF0C\u66F4\u65B0\u89C6\u56FE\u5185\u5BB9\u5462\uFF1F\u4F7F\u7528\u89C2\u5BDF\u8005\u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u521B\u5EFA Dep \u548C Wather \u7C7B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">observer</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u904D\u5386\u53D6\u51FA\u4F20\u5165\u5BF9\u8C61\u7684\u6240\u6709\u5C5E\u6027, \u7ED9\u904D\u5386\u5230\u7684\u5C5E\u6027\u90FD\u589E\u52A0get/set\u65B9\u6CD5</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defineRecative</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// obj: \u9700\u8981\u64CD\u4F5C\u7684\u5BF9\u8C61</span>
  <span class="token comment">// attr: \u9700\u8981\u65B0\u589Eget/set\u65B9\u6CD5\u7684\u5C5E\u6027</span>
  <span class="token comment">// value: \u9700\u8981\u65B0\u589Eget/set\u65B9\u6CD5\u5C5E\u6027\u7684\u53D6\u503C</span>
  <span class="token function">defineRecative</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> attr<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5982\u679C\u5C5E\u6027\u7684\u53D6\u503C\u53C8\u662F\u4E00\u4E2A\u5BF9\u8C61, \u90A3\u4E48\u4E5F\u9700\u8981\u7ED9\u8FD9\u4E2A\u5BF9\u8C61\u7684\u6240\u6709\u5C5E\u6027\u6DFB\u52A0get/set\u65B9\u6CD5</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token comment">// \u7B2C\u4E09\u6B65: \u5C06\u5F53\u524D\u5C5E\u6027\u7684\u6240\u6709\u89C2\u5BDF\u8005\u5BF9\u8C61\u90FD\u653E\u5230\u5F53\u524D\u5C5E\u6027\u7684\u53D1\u5E03\u8BA2\u9605\u5BF9\u8C61\u4E2D\u7BA1\u7406\u8D77\u6765</span>
    <span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u521B\u5EFA\u4E86\u5C5E\u4E8E\u5F53\u524D\u5C5E\u6027\u7684\u53D1\u5E03\u8BA2\u9605\u5BF9\u8C61</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> attr<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5728\u8FD9\u91CC\u6536\u96C6\u4F9D\u8D56</span>
        Dep<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
        <span class="token keyword">return</span> value
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">newValue</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u5982\u679C\u7ED9\u5C5E\u6027\u8D4B\u503C\u7684\u65B0\u503C\u53C8\u662F\u4E00\u4E2A\u5BF9\u8C61, \u90A3\u4E48\u4E5F\u9700\u8981\u7ED9\u8FD9\u4E2A\u5BF9\u8C61\u7684\u6240\u6709\u5C5E\u6027\u6DFB\u52A0get/set\u65B9\u6CD5</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observer</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>
          value <span class="token operator">=</span> newValue
          dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u76D1\u542C\u5230\u6570\u636E\u7684\u53D8\u5316&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u4F7F\u7528\u89C2\u5BDF\u8005\u8BBE\u8BA1\u6A21\u5F0F-\u521B\u5EFA-dep-\u548C-wather-\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u89C2\u5BDF\u8005\u8BBE\u8BA1\u6A21\u5F0F-\u521B\u5EFA-dep-\u548C-wather-\u7C7B" aria-hidden="true">#</a> \u4F7F\u7528\u89C2\u5BDF\u8005\u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u521B\u5EFA Dep \u548C Wather \u7C7B</h2><ol><li>\u4F7F\u7528\u89C2\u5BDF\u8005\u8BBE\u8BA1\u6A21\u5F0F\u7684\u76EE\u7684\u662F:</li></ol><ul><li>\u89E3\u6790\u6A21\u677F\uFF0C\u6536\u96C6 data \u4E2D\u67D0\u4E2A\u6570\u636E\u5728\u6A21\u677F\u4E2D\u88AB\u4F7F\u7528\u7684 dom \u8282\u70B9\u96C6\u5408\uFF0C\u5F53\u8BE5\u6570\u636E\u6539\u53D8\u65F6\uFF0C\u66F4\u65B0\u8BE5 dom \u8282\u70B9\u96C6\u5408\u5C31\u5B9E\u73B0\u4E86\u6570\u636E\u66F4\u65B0\u3002</li><li>Dep\uFF1A\u7528\u4E8E\u6536\u96C6\u67D0\u4E2A data \u5C5E\u6027\u4F9D\u8D56\u7684 dom \u8282\u70B9\u96C6\u5408\uFF0C\u5E76\u63D0\u4F9B\u66F4\u65B0\u65B9\u6CD5</li><li>Watcher\uFF1A\u6BCF\u4E2A dom \u8282\u70B9\u7684\u5305\u88F9\u5BF9\u8C61 <ul><li>attr\uFF1A\u8BE5 dom \u4F7F\u7528\u7684 data \u5C5E\u6027</li><li>cb\uFF1A\u4FEE\u6539\u8BE5 dom \u503C\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u5728\u521B\u5EFA\u7684\u65F6\u5019\u4F1A\u63A5\u6536</li></ul></li></ul><ol start="2"><li>\u5230\u8FD9\u91CC\u611F\u89C9\u601D\u8DEF\u662F\u6CA1\u95EE\u9898\u4E86\uFF0C\u5DF2\u7ECF\u662F\u80DC\u5238\u5728\u63E1\u4E86\u3002\u90A3 Dep \u548C Watcher \u8BE5\u600E\u4E48\u4F7F\u7528\u5462\uFF1F</li></ol>`,10),V=n("li",null,"\u4E3A\u6BCF\u4E2A\u5C5E\u6027\u6DFB\u52A0\u4E00\u4E2A dep\uFF0C\u7528\u6765\u6536\u96C6\u4F9D\u8D56\u7684 dom",-1),j=n("li",null,"\u56E0\u4E3A\u9875\u9762\u9996\u6B21\u6E32\u67D3\u7684\u65F6\u5019\u4F1A\u8BFB\u53D6 data \u6570\u636E\uFF0C\u8FD9\u65F6\u5019\u4F1A\u89E6\u53D1\u8BE5 data \u7684 getter\uFF0C\u6240\u4EE5\u5728\u6B64\u6536\u96C6 dom",-1),W=t(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8FD9\u4E2A\u6570\u7EC4\u5C31\u662F\u4E13\u95E8\u7528\u4E8E\u7BA1\u7406\u67D0\u4E2A\u5C5E\u6027\u6240\u6709\u7684\u89C2\u5BDF\u8005\u5BF9\u8C61\u7684</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u8BA2\u9605\u89C2\u5BDF\u7684\u65B9\u6CD5</span>
  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u53D1\u5E03\u8BA2\u9605\u7684\u65B9\u6CD5</span>
  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">watcher</span> <span class="token operator">=&gt;</span> watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> attr<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token keyword">this</span><span class="token punctuation">.</span>attr <span class="token operator">=</span> attr
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
    <span class="token comment">// \u5728\u521B\u5EFA\u89C2\u5BDF\u8005\u5BF9\u8C61\u7684\u65F6\u5019\u5C31\u53BB\u83B7\u53D6\u5F53\u524D\u7684\u65E7\u503C</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>oldValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getOldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">let</span> oldValue <span class="token operator">=</span> CompilerUtil<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">)</span>
    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">return</span> oldValue
  <span class="token punctuation">}</span>

  <span class="token comment">// \u5B9A\u4E49\u4E00\u4E2A\u66F4\u65B0\u7684\u65B9\u6CD5, \u7528\u4E8E\u5224\u65AD\u65B0\u503C\u548C\u65E7\u503C\u662F\u5426\u76F8\u540C</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> newValue <span class="token operator">=</span> CompilerUtil<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>oldValue <span class="token operator">!==</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>oldValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u5230\u8FD9\u91CC\u5C31\u5B9E\u73B0\u4E86\u6570\u636E\u7ED1\u5B9A\u65F6\uFF0C\u89C6\u56FE\u81EA\u52A8\u66F4\u65B0\uFF0C\u672C\u6765\u60F3\u4EE3\u7801\u4E00\u6B65\u6B65\u5B9E\u73B0\u7684\uFF0C\u4F46\u662F\u53D1\u73B0\u4E0D\u597D\u5904\u7406\uFF0C\u5C31\u628A\u5B8C\u6574\u7684 class \u8D34\u51FA\u6765\u4E86\u3002</li></ol><h2 id="\u5B9E\u73B0\u89C6\u56FE\u9A71\u52A8\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u89C6\u56FE\u9A71\u52A8\u6570\u636E" aria-hidden="true">#</a> \u5B9E\u73B0\u89C6\u56FE\u9A71\u52A8\u6570\u636E</h2><p>\u5176\u5B9E\u5C31\u662F\u76D1\u542C\u8F93\u5165\u6846\u7684 input\u3001change \u4E8B\u4EF6\u3002\u4FEE\u6539 CompilerUtil \u7684 model \u65B9\u6CD5\u3002\u5177\u4F53\u4EE3\u7801\u5982\u4E0B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function-variable function">model</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>value <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token comment">// \u770B\u8FD9\u91CC</span>
    node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> newValue <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a> \u603B\u7ED3</h2><p><strong>vue \u53CC\u5411\u7ED1\u5B9A\u539F\u7406</strong></p><p>vue \u63A5\u6536\u4E00\u4E2A\u6A21\u677F\u548C data \u53C2\u6570</p><ol><li>\u9996\u5148\u5C06 data \u4E2D\u7684\u6570\u636E\u8FDB\u884C\u9012\u5F52\u904D\u5386\uFF0C\u5BF9\u6BCF\u4E2A\u5C5E\u6027\u6267\u884C Object.defineProperty\uFF0C\u5B9A\u4E49 get \u548C set \u51FD\u6570\u3002\u5E76\u4E3A\u6BCF\u4E2A\u5C5E\u6027\u6DFB\u52A0\u4E00\u4E2A dep \u6570\u7EC4\u3002\u5F53 get \u6267\u884C\u65F6\uFF0C\u4F1A\u4E3A\u8C03\u7528\u7684 dom \u8282\u70B9\u521B\u5EFA\u4E00\u4E2A watcher \u5B58\u653E\u5728\u8BE5\u6570\u7EC4\u4E2D\u3002\u5F53 set \u6267\u884C\u65F6\uFF0C\u91CD\u65B0\u8D4B\u503C\uFF0C\u5E76\u8C03\u7528 dep \u6570\u7EC4\u7684 notify \u65B9\u6CD5\uFF0C\u901A\u77E5\u6240\u6709\u4F7F\u7528\u4E86\u8BE5\u5C5E\u6027 watcher\uFF0C\u5E76\u66F4\u65B0\u5BF9\u5E94 dom \u7684\u5185\u5BB9\u3002</li><li>\u5C06\u6A21\u677F\u52A0\u8F7D\u5230\u5185\u5B58\u4E2D\uFF0C\u9012\u5F52\u6A21\u677F\u4E2D\u7684\u5143\u7D20\uFF0C\u68C0\u6D4B\u5230\u5143\u7D20\u6709 v- \u5F00\u5934\u7684\u547D\u4EE4\u6216\u8005\u53CC\u5927\u62EC\u53F7\u7684\u6307\u4EE4\uFF0C\u5C31\u4F1A\u4ECE data \u4E2D\u53D6\u5BF9\u5E94\u7684\u503C\u53BB\u4FEE\u6539\u6A21\u677F\u5185\u5BB9\uFF0C\u8FD9\u4E2A\u65F6\u5019\u5C31\u5C06\u8BE5 dom \u5143\u7D20\u6DFB\u52A0\u5230\u4E86\u8BE5\u5C5E\u6027\u7684 dep \u6570\u7EC4\u4E2D\u3002\u8FD9\u5C31\u5B9E\u73B0\u4E86\u6570\u636E\u9A71\u52A8\u89C6\u56FE\u3002\u5728\u5904\u7406 v-model \u6307\u4EE4\u7684\u65F6\u5019\uFF0C\u4E3A\u8BE5 dom \u6DFB\u52A0 input \u4E8B\u4EF6\uFF08\u6216 change\uFF09\uFF0C\u8F93\u5165\u65F6\u5C31\u53BB\u4FEE\u6539\u5BF9\u5E94\u7684\u5C5E\u6027\u7684\u503C\uFF0C\u5B9E\u73B0\u4E86\u9875\u9762\u9A71\u52A8\u6570\u636E\u3002</li><li>\u5C06\u6A21\u677F\u4E0E\u6570\u636E\u8FDB\u884C\u7ED1\u5B9A\u540E\uFF0C\u5C06\u6A21\u677F\u6DFB\u52A0\u5230\u771F\u5B9E dom \u6811\u4E2D\u3002</li></ol><p><strong>\u5982\u4F55\u5C06 watcher \u653E\u5728 dep \u6570\u7EC4\u4E2D\uFF1F</strong></p><p>\u5728\u89E3\u6790\u6A21\u677F\u7684\u65F6\u5019\uFF0C\u4F1A\u6839\u636E v- \u6307\u4EE4\u83B7\u53D6\u5BF9\u5E94 data \u5C5E\u6027\u503C\uFF0C\u8FD9\u4E2A\u65F6\u5019\u5C31\u4F1A\u8C03\u7528\u5C5E\u6027\u7684 get \u65B9\u6CD5\uFF0C\u6211\u4EEC\u5148\u521B\u5EFA Watcher \u5B9E\u4F8B\uFF0C\u5E76\u5728\u5176\u5185\u90E8\u83B7\u53D6\u8BE5\u5C5E\u6027\u503C\uFF0C\u4F5C\u4E3A\u65E7\u503C\u5B58\u653E\u5728 watcher \u5185\u90E8\uFF0C\u6211\u4EEC\u5728\u83B7\u53D6\u8BE5\u503C\u4E4B\u524D\uFF0C\u5728 Watcher \u539F\u578B\u5BF9\u8C61\u4E0A\u6DFB\u52A0\u5C5E\u6027 Watcher.target = this; \u7136\u540E\u53D6\u503C\uFF0C\u5C06\u8BB2 Watcher.target = null\uFF1B\u8FD9\u6837 get \u5728\u88AB\u8C03\u7528\u7684\u65F6\u5019\u5C31\u53EF\u4EE5\u6839\u636E Watcher.target \u83B7\u53D6\u5230 watcher \u5B9E\u4F8B\u5BF9\u8C61\u3002</p><p><strong>methods \u7684\u539F\u7406</strong></p><p>\u521B\u5EFA vue \u5B9E\u4F8B\u7684\u65F6\u5019\uFF0C\u63A5\u6536 methods \u53C2\u6570</p><p>\u5728\u89E3\u6790\u6A21\u677F\u7684\u65F6\u5019\u9047\u5230 v-on \u7684\u6307\u4EE4\u3002\u4F1A\u5BF9\u8BE5 dom \u5143\u7D20\u6DFB\u52A0\u5BF9\u5E94\u4E8B\u4EF6\u7684\u76D1\u542C\uFF0C\u5E76\u4F7F\u7528 call \u65B9\u6CD5\u5C06 vue \u7ED1\u5B9A\u4E3A\u8BE5\u65B9\u6CD5\u7684 this\uFF1A<code>vm.$methods[value].call(vm, e);</code></p><p><strong>computed \u7684\u539F\u7406</strong></p><p>\u521B\u5EFA vue \u5B9E\u4F8B\u7684\u65F6\u5019\uFF0C\u63A5\u6536 computed \u53C2\u6570\u3002\u521D\u59CB\u5316 vue \u5B9E\u4F8B\u7684\u65F6\u5019\uFF0C\u4E3A computed \u7684 key \u8FDB\u884C Object.defineProperty \u5904\u7406\uFF0C\u5E76\u6DFB\u52A0 get \u5C5E\u6027\u3002</p>`,17);function C(E,T){const p=u("ExternalLinkIcon");return c(),l("div",null,[r,n("blockquote",null,[n("p",null,[s("vue.js \u662F\u91C7\u7528"),d,s("\u7ED3\u5408"),v,s("\u7684\u65B9\u5F0F\uFF0C\u901A\u8FC7"),m,s("\u6765\u52AB\u6301\u5404\u4E2A\u5C5E\u6027\u7684"),b,s("\uFF0C"),h,s("\uFF0C\u5728\u6570\u636E\u53D8\u52A8\u65F6\u53D1\u5E03\u6D88\u606F\u7ED9\u8BA2\u9605\u8005\uFF0C\u89E6\u53D1\u76F8\u5E94\u7684"),n("a",g,[s("\u76D1\u542C"),i(p)]),s("\u56DE\u8C03\u6765\u6E32\u67D3\u89C6\u56FE")])]),w,n("ul",null,[f,n("li",null,[s("\u6587\u672C\u8282\u70B9 "),n("ul",null,[n("li",null,"\u7528 buildText \u51FD\u6570\u68C0\u67E5\u6587\u672C\u4E2D\u6709\u65E0 "+a()+" \u5185\u5BB9",1)])])]),n("ol",y,[n("li",null,"\u521B\u5EFA CompilerUtil \u7C7B\uFF0C\u7528\u4E8E\u5904\u7406 vue \u6307\u4EE4\u548C "+a()+"\uFF0C\u5B8C\u6210\u6570\u636E\u7684\u6E32\u67D3",1),x]),_,n("ul",null,[V,j,n("li",null,"\u5177\u4F53\u5982\u4F55\u6536\u96C6\u5462\uFF0C\u5728 CompilerUtil \u7C7B\u89E3\u6790 v-model\uFF0C"+a()+" \u7B49\u547D\u4EE4\u65F6\uFF0C\u4F1A\u89E6\u53D1 getter\uFF0C\u6211\u4EEC\u5728\u89E6\u53D1\u4E4B\u524D\u521B\u5EFA Wather\uFF0C\u4E3A Watcher \u6DFB\u52A0\u4E00\u4E2A\u9759\u6001\u5C5E\u6027,\u6307\u5411\u8BE5 dom\uFF0C\u7136\u540E\u5728 getter \u51FD\u6570\u91CC\u9762\u83B7\u53D6\u8BE5\u9759\u6001\u53D8\u91CF\uFF0C\u5E76\u6DFB\u52A0\u5230\u4F9D\u8D56\u4E2D\uFF0C\u5C31\u5B8C\u6210\u4E86\u4E00\u6B21\u6536\u96C6\u3002\u56E0\u4E3A\u6BCF\u6B21\u89E6\u53D1 getter \u4E4B\u524D\u90FD\u5BF9\u8BE5\u9759\u6001\u53D8\u91CF\u8D4B\u503C\uFF0C\u6240\u4EE5\u4E0D\u5B58\u5728\u6536\u96C6\u9519\u4F9D\u8D56\u7684\u60C5\u51B5\u3002",1)]),W])}const $=o(k,[["render",C],["__file","defineProperty.html.vue"]]);export{$ as default};
